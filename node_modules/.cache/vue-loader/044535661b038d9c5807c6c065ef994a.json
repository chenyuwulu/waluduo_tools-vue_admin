{"remainingRequest":"D:\\we_sub\\gf-vue-admin\\web\\node_modules\\_vue-loader@15.9.3@vue-loader\\lib\\index.js??vue-loader-options!D:\\we_sub\\gf-vue-admin\\web\\src\\view\\example\\upload\\upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\we_sub\\gf-vue-admin\\web\\src\\view\\example\\upload\\upload.vue","mtime":1601342948871},{"path":"D:\\we_sub\\gf-vue-admin\\web\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\we_sub\\gf-vue-admin\\web\\node_modules\\_babel-loader@8.1.0@babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\we_sub\\gf-vue-admin\\web\\node_modules\\_cache-loader@4.1.0@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\we_sub\\gf-vue-admin\\web\\node_modules\\_vue-loader@15.9.3@vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpjb25zdCBwYXRoID0gcHJvY2Vzcy5lbnYuVlVFX0FQUF9CQVNFX0FQSTsNCmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsNCmltcG9ydCBpbmZvTGlzdCBmcm9tICJAL2NvbXBvbmVudHMvbWl4aW5zL2luZm9MaXN0IjsNCmltcG9ydCB7IGdldEZpbGVMaXN0LCBkZWxldGVGaWxlIH0gZnJvbSAiQC9hcGkvZmlsZVVwbG9hZEFuZERvd25sb2FkIjsNCmltcG9ydCB7IGRvd25sb2FkSW1hZ2UgfSBmcm9tICJAL3V0aWxzL2Rvd25sb2FkSW1nIjsNCmltcG9ydCB7IGZvcm1hdFRpbWVUb1N0ciB9IGZyb20gIkAvdXRpbHMvZGF0YSI7DQppbXBvcnQgQ3VzdG9tUGljIGZyb20gJ0AvY29tcG9uZW50cy9jdXN0b21QaWMnDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJVcGxvYWQiLA0KICBtaXhpbnM6IFtpbmZvTGlzdF0sDQogIGNvbXBvbmVudHM6IHsNCgkJQ3VzdG9tUGljDQoJfSwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZnVsbHNjcmVlbkxvYWRpbmc6IGZhbHNlLA0KICAgICAgbGlzdEFwaTogZ2V0RmlsZUxpc3QsDQogICAgICBwYXRoOiBwYXRoLA0KICAgICAgdGFibGVEYXRhOiBbXSwNCiAgICB9Ow0KICB9LA0KICBjb21wdXRlZDogew0KICAgIC4uLm1hcEdldHRlcnMoInVzZXIiLCBbInVzZXJJbmZvIiwgInRva2VuIl0pLA0KICB9LA0KICBmaWx0ZXJzOiB7DQogICAgZm9ybWF0RGF0ZTogZnVuY3Rpb24odGltZSkgew0KICAgICAgaWYgKHRpbWUgIT0gbnVsbCAmJiB0aW1lICE9ICIiKSB7DQogICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUodGltZSk7DQogICAgICAgIHJldHVybiBmb3JtYXRUaW1lVG9TdHIoZGF0ZSwgInl5eXktTU0tZGQgaGg6bW06c3MiKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJldHVybiAiIjsNCiAgICAgIH0NCiAgICB9LA0KICB9LA0KICBtZXRob2RzOiB7DQogICAgYXN5bmMgZGVsZXRlRmlsZShyb3cpIHsNCiAgICAgIHRoaXMuJGNvbmZpcm0oIuatpOaTjeS9nOWwhuawuOS5heaWh+S7tiwg5piv5ZCm57un57utPyIsICLmj5DnpLoiLCB7DQogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi56Gu5a6aIiwNCiAgICAgICAgY2FuY2VsQnV0dG9uVGV4dDogIuWPlua2iCIsDQogICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgIH0pDQogICAgICAgIC50aGVuKGFzeW5jICgpID0+IHsNCiAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBkZWxldGVGaWxlKHJvdyk7DQogICAgICAgICAgaWYgKHJlcy5jb2RlID09IDApIHsNCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uoew0KICAgICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsDQogICAgICAgICAgICAgIG1lc3NhZ2U6ICLliKDpmaTmiJDlip8hIiwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgdGhpcy5nZXRUYWJsZURhdGEoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pDQogICAgICAgIC5jYXRjaCgoKSA9PiB7DQogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7DQogICAgICAgICAgICB0eXBlOiAiaW5mbyIsDQogICAgICAgICAgICBtZXNzYWdlOiAi5bey5Y+W5raI5Yig6ZmkIiwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfSwNCiAgICBjaGVja0ZpbGUoZmlsZSkgew0KICAgICAgdGhpcy5mdWxsc2NyZWVuTG9hZGluZyA9IHRydWU7DQogICAgICBjb25zdCBpc0pQRyA9IGZpbGUudHlwZSA9PT0gImltYWdlL2pwZWciOw0KICAgICAgY29uc3QgaXNQbmcgPSBmaWxlLnR5cGUgPT09ICJpbWFnZS9wbmciOw0KICAgICAgY29uc3QgaXNMdDJNID0gZmlsZS5zaXplIC8gMTAyNCAvIDEwMjQgPCAyOw0KICAgICAgaWYgKCFpc0pQRyAmJiAhaXNQbmcpIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5LiK5Lyg5aS05YOP5Zu+54mH5Y+q6IO95pivIEpQR+aIlnBuZyDmoLzlvI8hIik7DQogICAgICAgIHRoaXMuZnVsbHNjcmVlbkxvYWRpbmcgPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIGlmICghaXNMdDJNKSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuS4iuS8oOWktOWDj+WbvueJh+Wkp+Wwj+S4jeiDvei2hei/hyAyTUIhIik7DQogICAgICAgIHRoaXMuZnVsbHNjcmVlbkxvYWRpbmcgPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiAoaXNQbmcgfHwgaXNKUEcpICYmIGlzTHQyTTsNCiAgICB9LA0KICAgIHVwbG9hZFN1Y2Nlc3MocmVzKSB7DQogICAgICB0aGlzLmZ1bGxzY3JlZW5Mb2FkaW5nID0gZmFsc2U7DQogICAgICBpZiAocmVzLmNvZGUgPT0gMCkgew0KICAgICAgICB0aGlzLiRtZXNzYWdlKHsNCiAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsDQogICAgICAgICAgbWVzc2FnZTogIuS4iuS8oOaIkOWKnyIsDQogICAgICAgIH0pOw0KICAgICAgICBpZiAocmVzLmNvZGUgPT0gMCkgew0KICAgICAgICAgIHRoaXMuZ2V0VGFibGVEYXRhKCk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRoaXMuJG1lc3NhZ2Uoew0KICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwNCiAgICAgICAgICBtZXNzYWdlOiByZXMubXNnLA0KICAgICAgICB9KTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHVwbG9hZEVycm9yKCkgew0KICAgICAgdGhpcy4kbWVzc2FnZSh7DQogICAgICAgIHR5cGU6ICJlcnJvciIsDQogICAgICAgIG1lc3NhZ2U6ICLkuIrkvKDlpLHotKUiLA0KICAgICAgfSk7DQogICAgICB0aGlzLmZ1bGxzY3JlZW5Mb2FkaW5nID0gZmFsc2U7DQogICAgfSwNCiAgICBkb3dubG9hZEZpbGUocm93KSB7DQogICAgICBkb3dubG9hZEltYWdlKHJvdy51cmwsIHJvdy5uYW1lKTsNCiAgICB9LA0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuZ2V0VGFibGVEYXRhKCk7DQogIH0sDQp9Ow0K"},{"version":3,"sources":["upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upload.vue","sourceRoot":"src/view/example/upload","sourcesContent":["<template>\r\n  <div v-loading.fullscreen.lock=\"fullscreenLoading\">\r\n    <div class=\"upload\">\r\n      <el-upload\r\n        :action=\"`${path}/fileUploadAndDownload/upload`\"\r\n        :before-upload=\"checkFile\"\r\n        :headers=\"{ 'x-token': token }\"\r\n        :on-error=\"uploadError\"\r\n        :on-success=\"uploadSuccess\"\r\n        :show-file-list=\"false\"\r\n      >\r\n        <el-button size=\"small\" type=\"primary\">点击上传</el-button>\r\n        <div class=\"el-upload__tip\" slot=\"tip\">\r\n          只能上传jpg/png文件，且不超过500kb\r\n        </div>\r\n      </el-upload>\r\n      <el-table :data=\"tableData\" border stripe>\r\n        <el-table-column label=\"预览\" width=\"100\">\r\n          <template slot-scope=\"scope\">\r\n            <CustomPic picType=\"file\" :picSrc=\"scope.row.url\"/>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"日期\" prop=\"UpdatedAt\" width=\"180\">\r\n          <template slot-scope=\"scope\">\r\n            <div>{{ scope.row.UpdatedAt | formatDate }}</div>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column\r\n          label=\"文件名\"\r\n          prop=\"name\"\r\n          width=\"180\"\r\n        ></el-table-column>\r\n        <el-table-column label=\"链接\" prop=\"url\" min-width=\"300\"></el-table-column>\r\n        <el-table-column label=\"标签\" prop=\"tag\" width=\"100\">\r\n          <template slot-scope=\"scope\">\r\n            <el-tag\r\n              :type=\"scope.row.tag === 'jpg' ? 'primary' : 'success'\"\r\n              disable-transitions\r\n              >{{ scope.row.tag }}</el-tag\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\" width=\"160\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button @click=\"downloadFile(scope.row)\" size=\"small\" type=\"text\"\r\n              >下载</el-button\r\n            >\r\n            <el-button @click=\"deleteFile(scope.row)\" size=\"small\" type=\"text\"\r\n              >删除</el-button\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <el-pagination\r\n        :current-page=\"page\"\r\n        :page-size=\"pageSize\"\r\n        :page-sizes=\"[10, 30, 50, 100]\"\r\n        :style=\"{ float: 'right', padding: '20px' }\"\r\n        :total=\"total\"\r\n        @current-change=\"handleCurrentChange\"\r\n        @size-change=\"handleSizeChange\"\r\n        layout=\"total, sizes, prev, pager, next, jumper\"\r\n      ></el-pagination>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nconst path = process.env.VUE_APP_BASE_API;\r\nimport { mapGetters } from \"vuex\";\r\nimport infoList from \"@/components/mixins/infoList\";\r\nimport { getFileList, deleteFile } from \"@/api/fileUploadAndDownload\";\r\nimport { downloadImage } from \"@/utils/downloadImg\";\r\nimport { formatTimeToStr } from \"@/utils/data\";\r\nimport CustomPic from '@/components/customPic'\r\nexport default {\r\n  name: \"Upload\",\r\n  mixins: [infoList],\r\n  components: {\r\n\t\tCustomPic\r\n\t},\r\n  data() {\r\n    return {\r\n      fullscreenLoading: false,\r\n      listApi: getFileList,\r\n      path: path,\r\n      tableData: [],\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters(\"user\", [\"userInfo\", \"token\"]),\r\n  },\r\n  filters: {\r\n    formatDate: function(time) {\r\n      if (time != null && time != \"\") {\r\n        var date = new Date(time);\r\n        return formatTimeToStr(date, \"yyyy-MM-dd hh:mm:ss\");\r\n      } else {\r\n        return \"\";\r\n      }\r\n    },\r\n  },\r\n  methods: {\r\n    async deleteFile(row) {\r\n      this.$confirm(\"此操作将永久文件, 是否继续?\", \"提示\", {\r\n        confirmButtonText: \"确定\",\r\n        cancelButtonText: \"取消\",\r\n        type: \"warning\",\r\n      })\r\n        .then(async () => {\r\n          const res = await deleteFile(row);\r\n          if (res.code == 0) {\r\n            this.$message({\r\n              type: \"success\",\r\n              message: \"删除成功!\",\r\n            });\r\n            this.getTableData();\r\n          }\r\n        })\r\n        .catch(() => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"已取消删除\",\r\n          });\r\n        });\r\n    },\r\n    checkFile(file) {\r\n      this.fullscreenLoading = true;\r\n      const isJPG = file.type === \"image/jpeg\";\r\n      const isPng = file.type === \"image/png\";\r\n      const isLt2M = file.size / 1024 / 1024 < 2;\r\n      if (!isJPG && !isPng) {\r\n        this.$message.error(\"上传头像图片只能是 JPG或png 格式!\");\r\n        this.fullscreenLoading = false;\r\n      }\r\n      if (!isLt2M) {\r\n        this.$message.error(\"上传头像图片大小不能超过 2MB!\");\r\n        this.fullscreenLoading = false;\r\n      }\r\n      return (isPng || isJPG) && isLt2M;\r\n    },\r\n    uploadSuccess(res) {\r\n      this.fullscreenLoading = false;\r\n      if (res.code == 0) {\r\n        this.$message({\r\n          type: \"success\",\r\n          message: \"上传成功\",\r\n        });\r\n        if (res.code == 0) {\r\n          this.getTableData();\r\n        }\r\n      } else {\r\n        this.$message({\r\n          type: \"warning\",\r\n          message: res.msg,\r\n        });\r\n      }\r\n    },\r\n    uploadError() {\r\n      this.$message({\r\n        type: \"error\",\r\n        message: \"上传失败\",\r\n      });\r\n      this.fullscreenLoading = false;\r\n    },\r\n    downloadFile(row) {\r\n      downloadImage(row.url, row.name);\r\n    },\r\n  },\r\n  created() {\r\n    this.getTableData();\r\n  },\r\n};\r\n</script>\r\n"]}]}